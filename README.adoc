= Hazelcast Documentation Site

image:https://img.shields.io/github/workflow/status/JakeSCahill/docs-poc/Build%20site[GitHub Workflow Status] image:https://img.shields.io/github/workflow/status/JakeSCahill/docs-poc/Index%20site?label=Indexer[GitHub Workflow Status] image:https://img.shields.io/github/workflow/status/JakeSCahill/docs-poc/Publish?label=GitHub%20Pages[GitHub Workflow Status]

This repository hosts an https://docs.antora.org/antora/2.3/[Antora] playbook project for the Hazelcast documentation site.

image::images/docs-preview.png[Preview of the documentation site]

== Work in progress

The roadmap for this site includes the following items:

- [ ] Migrate Hazelcast Cloud content
- [ ] Migrate Jet content
- [ ] Migrate Management Center content
- [ ] Review and restructure content, starting with IMDG

== Introduction to Antora

Antora is a static site generator that facilitates a docs-as-code workflow where documentation is stored in Git repositories and processed to output a static website.

Documentation can be stored in one or more repositories and/or branches.

Antora uses Asciidoctor.js to convert Asciidoc to HTML, then it uses Handlebars to set that HTML into a page layout.

NOTE: The page layouts and UI code (css, JavaScript, Handlebars templates) is stored in a https://github.com/JakeSCahill/docs-poc-ui[separate repository], which outputs a `ui-bundle.zip` file that this project references in the playbook.

video::BAJ8F7yQz64[youtube]

== The playbook

The playbook defines the content sources (repositories and branches), site URL, UI bundle URL, global AsciiDoc attributes, and Asciidoctor extensions.

This project has two playbook files, which configure the build process for the documentation site:

- `antora-playbook-local.yml`: <<local-builds, For local builds>>
- `antora-playbook.yml`: For production builds

The current playbooks pull from the following content sources:

- The `latest`, `latest-dev`, and `archive` branches of this forked[`hazelcast-reference-manual` repository](https://github.com/JakeSCahill/hazelcast-reference-manual)
- The `home/` folder in this repository, which contains an Antora component for the home page

[[home]]
== Home Component

The `home/` folder in this repository contains the source for the Home documentation component with links to all major documentation projects.

image::images/home-page.png[Preview of the home page]

== Custom Asciidoctor Extensions
The custom extension in the `lib/` directory processes the Asciidoc `tabs` blocks to generate tabbed code samples in the output HTML.

For more information about writing Asciidoctor.js extensions, see the https://asciidoctor-docs.netlify.app/asciidoctor.js/latest/extend/extensions[Asciidoctor docs].

== GitHub Actions

To automate some elements of the build process, this repository includes the following GitHub Actions:

.GitHub Actions
[cols="m,a,a"]
|===
|File |Description |Triggers

|validate-site.yml
|Validates that the build process completes without errors and checks that all internal links are working
|On a pull request to both this repository and any repositories listed in the `content.sources` field of the playbook

|build-site.yml
|Builds the site and commits the result to the `develop branch` of this repository
|On a push to both this repository and any repositories listed in the `content.sources` field of the playbook

|index-site.yml
|Runs the Docsearch indexer in a Docker container to index the site and send the index to Algolia
|Once per day at 00:00 UTC

|publish.yml
|Commits the contents of the `docs` folder on the `develop` branch to the `master` branch, which is set up to host the site on GitHub Pages
|Manual trigger
|===

[[local-builds]]
== Working on the docs locally

When working on a documentation project, you should build and preview the docs on your local machine to see your changes before going live.

=== Prerequisites

Antora requires an active long term support (LTS) release of Node.js. To check if you have Node.js installed, do the following:

```bash
node --version
```

If you see an active Node.js LTS version on your device, youâ€™re ready to build the docs.

If no version number is displayed in the output, you need to [install Node.js](https://nodejs.org/en/download/).

=== Step 1. Clone a documentation project

Documentation is hosted in separate GitHub repositorites. So, to work on a particular documentation project, you must clone it and configure the `antora-playbook-local.yml` file to process your local version.

For example, to build the IMDG reference manual on your local device:

. Clone the [`hazelcast-reference-manual` repository](https://github.com/JakeSCahill/hazelcast-reference-manual), and check out the branch that you want to work on
+
[source,bash]
----
git clone https://github.com/JakeSCahill/hazelcast-reference-manual
cd hazelcast-reference-manual
git checkout latest
----

. Clone this repository
+
[source,bash]
----
cd ..
git clone https://github.com/JakeSCahill/docs-poc
cd docs-poc
----

. Edit the `antora-playbook-local.yml` file to process your local version
+
[source,yaml]
----
content:
  sources: 
  - url: .
    start_path: home
    branches: HEAD
  - url: ../hazelcast-reference-manual
    start_path: docs
    branches: HEAD
----
+
NOTE: `branches: HEAD` tells Antora to pull content from the head of your locally checked out branch.

. Run the local build script
+
[source,bash]
----
npm i
npm run-script build-local
----
+
NOTE: This script is defined in the `package.json` file, and run Antora with the `antora-playbook-local.yml` file.

You will see the following warnings:

[source,bash]
----
asciidoctor: WARNING: migration_guides.adoc: line 1025: unterminated listing block
asciidoctor: WARNING: migration_guides.adoc: line 1043: unterminated listing block
----

These are yet to be fixed.

In the `docs` folder you will now have all the webpages for your documentation site.

## Host the docs

To view the documentation site from a localhost web server, run the `serve` script

[source,bash]
----
npm run-script serve
----

If you want to show the team your changes, you can expose your web server to the Internet, using ngrok by doing the following:

```bash
npm run-script expose
```

The public URL is displayed in the output:

image::images/ngrok.png[ngrok output]
